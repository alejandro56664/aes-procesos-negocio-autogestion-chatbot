package com.aes.procesos.autogestion.sor.util;

import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.List;
import java.util.stream.Collectors;

import org.springframework.stereotype.Service;

import com.aes.procesos.autogestion.sor.model.Incidencia;
import com.aes.procesos.autogestion.sor.model.RegistroAccionCorrectiva;
import com.aes.procesos.autogestion.sor.model.ServicioContratado;
import com.aes.procesos.autogestion.sor.model.dto.EstadoFinancieroServicioDTO;
import com.aes.procesos.autogestion.sor.model.dto.EstadoServicioContratadoDTO;
import com.aes.procesos.autogestion.sor.model.dto.EstadoServicioHadaDTO;
import com.aes.procesos.autogestion.sor.model.dto.ResultadoEjecucionAccionCorrectivaDTO;
import com.aes.procesos.autogestion_integracion_sor.ConsultarAveriasByIdServicioResponse;
import com.aes.procesos.autogestion_integracion_sor.ConsultarPeticionesByIdServicioResponse;
import com.aes.procesos.autogestion_integracion_sor.EjecutarAccionCorrectivaAutomaticaResponse;
import com.aes.procesos.autogestion_integracion_sor.EstadoServicioContratado;
import com.aes.procesos.autogestion_integracion_sor.IncidenciaResponse;
import com.aes.procesos.autogestion_integracion_sor.ResultadoOperacion;
import com.aes.procesos.autogestion_integracion_sor.ValidarEstadoServicioByIdResponse;
import com.aes.procesos.autogestion_integracion_sor.Error;
@Service
public class Traductor {

	public ValidarEstadoServicioByIdResponse toResponse(EstadoServicioContratadoDTO dto) {
		ValidarEstadoServicioByIdResponse response = new ValidarEstadoServicioByIdResponse();
		
		EstadoServicioContratado estado = new EstadoServicioContratado();
		estado.setActivo(dto.isActivo());
		
		String pattern = "dd/MM/yyyy";
		SimpleDateFormat sdf = new SimpleDateFormat(pattern);
		
		estado.setFechaCorte(sdf.format(dto.getFechaCorte()));
		estado.setValorAPagar(dto.getValorAPagar());
		response.setEstado(estado);
		return response;
	}

	public EjecutarAccionCorrectivaAutomaticaResponse toResponse(
			ResultadoEjecucionAccionCorrectivaDTO resultadoDTO) {
		EjecutarAccionCorrectivaAutomaticaResponse response = new EjecutarAccionCorrectivaAutomaticaResponse();
		ResultadoOperacion resultadoAC = new ResultadoOperacion();
		
		resultadoAC.setExitoso(resultadoDTO.getCodigo().equalsIgnoreCase("OK"));
		resultadoAC.setCodigo(resultadoDTO.getCodigo());
		resultadoAC.setDescripcion(resultadoDTO.getMensaje());
		response.setResultado(resultadoAC);
		return response;
	}

	public RegistroAccionCorrectiva toEntity(ResultadoEjecucionAccionCorrectivaDTO dto, ServicioContratado servicioContratado) {
		RegistroAccionCorrectiva entity = new RegistroAccionCorrectiva();
		entity.setAccionEjecutada(dto.getTipoAccion());
		entity.setExitosos(dto.getCodigo().equalsIgnoreCase("OK"));
		entity.setResultado("codigo: "+ dto.getCodigo() + ", mensaje: " + dto.getMensaje());
		entity.setServicioContratado(servicioContratado);
		entity.setTimestamp(new Timestamp(System.currentTimeMillis()));
		return entity;
	}
	
	
	public ResultadoOperacion toResultadoOperacion(boolean result) {
		ResultadoOperacion resultOp = new ResultadoOperacion();
		resultOp.setExitoso(result);
		resultOp.setCodigo("OK");
		return resultOp;
	}

	public ConsultarPeticionesByIdServicioResponse toResponsePeticiones(
			List<Incidencia> incidencias) {
		ConsultarPeticionesByIdServicioResponse response = new ConsultarPeticionesByIdServicioResponse();
		response.getResultado().addAll(toResponse(incidencias));
		return response;
	}

	public ConsultarAveriasByIdServicioResponse toResponseAverias(List<Incidencia> incidencias) {
		ConsultarAveriasByIdServicioResponse response = new ConsultarAveriasByIdServicioResponse();
		response.getResultado().addAll(toResponse(incidencias));
		return response;
	}
	
	public List<IncidenciaResponse> toResponse(List<Incidencia> incidencias) {
		return incidencias.stream().map((incidencia) -> {
			return toResponse(incidencia);
		}).collect(Collectors.toList());
	}
	
	public IncidenciaResponse toResponse(Incidencia incidencia) {
		IncidenciaResponse response = new IncidenciaResponse();
		response.setCanal(incidencia.getCanal());
		response.setTitulo(incidencia.getTitulo());
		response.setDescripcion(incidencia.getDescripcion());
		response.setEstado(incidencia.getEstado());
		response.setTimestamp(incidencia.getTimestamp().toString());
		return response;
	}

	public ValidarEstadoServicioByIdResponse toError(String codigo, String descripcion) {
		ValidarEstadoServicioByIdResponse response = new ValidarEstadoServicioByIdResponse();
		Error error = new Error();
		error.setCodigo(codigo);
		error.setDescripcion(descripcion);
		
		response.setError(error);
		return response;
	}

	public ValidarEstadoServicioByIdResponse toResponse(EstadoServicioHadaDTO validarEstadoServicioEnHADA) {
		// TODO Auto-generated method stub
		return null;
	}

	public ValidarEstadoServicioByIdResponse toResponse(EstadoFinancieroServicioDTO validarEstadoFinancieroServicio) {
		// TODO Auto-generated method stub
		return null;
	}

	
	

}
