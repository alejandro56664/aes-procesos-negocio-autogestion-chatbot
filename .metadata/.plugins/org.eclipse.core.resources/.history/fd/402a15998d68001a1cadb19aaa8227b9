package com.aes.procesos.autogestion.sor.endpoint;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.ws.server.endpoint.annotation.Endpoint;
import org.springframework.ws.server.endpoint.annotation.PayloadRoot;
import org.springframework.ws.server.endpoint.annotation.RequestPayload;
import org.springframework.ws.server.endpoint.annotation.ResponsePayload;

import com.aes.procesos.autogestion.sor.service.EjecutorAccionCorrectivaService;
import com.aes.procesos.autogestion.sor.service.GestorIncidenciaService;
import com.aes.procesos.autogestion.sor.service.ValidadorTecnicoService;
import com.aes.procesos.autogestion.sor.util.Traductor;
import com.aes.procesos.autogestion_integracion_sor.EjecutarAccionCorrectivaAutomaticaRequest;
import com.aes.procesos.autogestion_integracion_sor.EjecutarAccionCorrectivaAutomaticaResponse;
import com.aes.procesos.autogestion_integracion_sor.RegistrarAuditoriaRequest;
import com.aes.procesos.autogestion_integracion_sor.RegistrarAuditoriaResponse;
import com.aes.procesos.autogestion_integracion_sor.ValidarEstadoServicioByIdRequest;
import com.aes.procesos.autogestion_integracion_sor.ValidarEstadoServicioByIdResponse;


@Endpoint
public class IntegracionSOREndpoint {
	private static final String NAMESPACE_URI = "http://aes.com/procesos/autogestion-integracion-sor";
	
	@Autowired
	private ValidadorTecnicoService validadorTecnico;
	
	@Autowired
	private EjecutorAccionCorrectivaService ejecutorAccionCorrectiva;
	
	@Autowired
	private GestorIncidenciaService gestorIncidencia;

	@Autowired
	private Traductor traductor;

	@PayloadRoot(namespace = NAMESPACE_URI, localPart = "validarEstadoServicioByIdRequest")
	@ResponsePayload
	public ValidarEstadoServicioByIdResponse validarEstadoServicio(@RequestPayload ValidarEstadoServicioByIdRequest request) {
		
		return traductor.toResponse(validadorTecnico.validarEstadoServicioContratado(request.getIdServicio()));
	}
	
	@PayloadRoot(namespace = NAMESPACE_URI, localPart = "ejecutarAccionCorrectivaAutomaticaRequest")
	@ResponsePayload
	public EjecutarAccionCorrectivaAutomaticaResponse ejecutarAccionCorrectivaAutomatica(@RequestPayload EjecutarAccionCorrectivaAutomaticaRequest request) {
		
		return traductor.toResponse(ejecutorAccionCorrectiva.ejecutar(request.getIdServicio(), request.getAccion().toString()));
	}
	
	@PayloadRoot(namespace = NAMESPACE_URI, localPart = "registrarAuditoriaRequest")
	@ResponsePayload
	public RegistrarAuditoriaResponse registrarAuditoria(@RequestPayload RegistrarAuditoriaRequest request) {
		
		return traductor.toResponse(gestorIncidencia.registrarAuditoria(request.getIdServicio(), 
				request.getTitulo(), 
				request.getDescripcion(),
				request.getCanal()));
	}
}
